<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <style>
      * {
        box-sizing: border-box;
      }
      header {
        background: linear-gradient(
          90deg,
          #253237 50%,
          rgba(255, 255, 255, 0) 50%
        );
      }
      .header-bg {
        background-color: #253237;
background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239db4c0' fill-opacity='0.4' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
      }

      /* Style for the table */
      table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }

        /* Style for the drop zone */
        .drop-zone {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            cursor: pointer;
        }
    </style>
  </head>
  <body>
    <main class="">
      <div class="header-bg">
        <header class="sm:p-16 sm:pt-8">

          <div class="max-w-2xl m-auto ">
                      <div class="flex justify-center  w-6/12 pb-4">
            <img src="./logo.png"  class="h-32 " style="" />
          </div>
            <div class="w-6/12 flex justify-center flex-col text-center  ">
              <h1 class="text-4xl font-semibold leading-7 text-gray-50">
                Envío de difusión
              </h1>
              <p class="mt-5 text-sm leading-6 font-medium text-gray-200 flex ">
                debe contar con el archivo csv y la imagen de la plantilla en
                caso de requerirla.
              </p>
            </div>
          </div>
        </header>
      </div>
      <div class="bg-[#D6E3DC] px-4 ">
        <div class="max-w-2xl m-auto">
          <form>
            <div class="space-y-12">
              <div class="border-b border-gray-900/10 pb-12">
                <div
                  class="pt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                >
                  <div class="sm:col-span-full">
                    <label
                      for="first-name"
                      class="block text-sm font-medium leading-6 text-gray-900"
                      >Nombre de la campaña</label
                    >
                    <div class="mt-2">
                      <input
                        type="text"
                        name="first-name"
                        id="first-name"
                        autocomplete="given-name"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                      />
                    </div>
                  </div>

                  <div class="sm:col-span-3">
                    <label
                      for="lines"
                      class="block text-sm font-medium leading-6 text-gray-900"
                      >Líneas disponibles</label
                    >
                    <div class="mt-2">
                      <select
                        id="lines"
                        name="lines"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"
                      >

                      </select>
                    </div>
                  </div>
                  <div class="sm:col-span-3">
                    <label
                      for="template"
                      class="block text-sm font-medium leading-6 text-gray-900"
                      >Plantillas disponibles</label
                    >
                    <div class="mt-2">
                      <select
                        id="template"
                        name="template"
                        autocomplete="template-name"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"
                      >

                      </select>
                    </div>
                  </div>

                  <div class="col-span-full">
                    <label
                      for="cover-photo"
                      class="block text-sm font-medium leading-6 text-gray-900"
                      >Imagen para plantilla</label
                    >
                    <div
                      class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10"
                    >
                      <div class="text-center">
                        <svg
                          class="mx-auto h-12 w-12 text-gray-300"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                          aria-hidden="true"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z"
                            clip-rule="evenodd"
                          />
                        </svg>
                        <div class="mt-4 flex text-sm leading-6 text-gray-600">
                          <label
                            for="file-upload"
                            class="relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500"
                          >
                            <span>Sube una imagen</span>
                            <input
                              id="file-upload"
                              name="file-upload"
                              type="file"
                              class="sr-only"
                            />
                          </label>
                          <p class="pl-1">o arrastra y suelta</p>
                        </div>
                        <p class="text-xs leading-5 text-gray-600">
                          PNG, JPG, GIF hasta 10MB
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div>
                <!-- Drop zone for drag-and-drop -->
                <div class="drop-zone" id="dropZone">
                    <span>Sube un archivo CSV</span>
                    <p class="pl-1"></p>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" />
                    <button id="uploadButton">Or Select File</button>
                </div>
            </div>
                <!-- Table to display CSV data -->
                <table id="csvTable">
                    <!-- Table headers will be generated here -->
                </table>
            </div>

            <div class="mt-6 flex items-center justify-end gap-x-6">
              <button
                type="button"
                class="text-sm font-semibold leading-6 text-gray-900"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
              >
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script>

        let templateData = [];
        let linesData = [];
       // Function to fetch data from an API
        async function fetchData(apiUrl) {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("Error fetching data: ", error);
            }
        }

        // Function to populate a select element with options
        function populateSelect(selectId, data, optionKey, optionValue) {
            const select = document.getElementById(selectId);
             select.innerHTML = "";
            data.forEach(item => {
                const option = document.createElement("option");
                option.value = item[optionKey];
                option.text = item[optionValue];
                select.appendChild(option);
            });
        }

        // API URLs
        const templateApiUrl = "templates.json";
        const linesApiUrl = "phones.json";

        // Fetch data and populate select elements when the page loads
        window.addEventListener("load", async () => {
            linesData = await fetchData(linesApiUrl);
            populateSelect("lines", linesData, "whatsapp_account", "nombre_whatsapp");

            // Add event listener to lines select element
            const linesSelect = document.getElementById("lines");
            linesSelect.addEventListener("change", () => {
                const selectedAccountId = linesSelect.value;

                // Filter templateData based on the selected account ID
                const filteredTemplates = templateData.filter(template => template.cuenta === selectedAccountId);

                // Populate the template select element with filtered data
                populateSelect("template", filteredTemplates, "id_plantilla", "nombre_plantilla");
            });

            // Add event listener to template select element
            const templateSelect = document.getElementById("template");
            templateSelect.addEventListener("change", () => {
                const selectedTemplate = templateSelect.options[templateSelect.selectedIndex];
                const selectedLine = linesSelect.options[linesSelect.selectedIndex];
                
                const campaign = "campaign: " + selectedTemplate.text;
                const valor = " Valor: " + selectedTemplate.value;
                const texto = " Texto: " + selectedLine.text + " " + selectedLine.value;
                const result = campaign +valor+ texto;

                console.log(result);
            });

            // Load template data initially
            templateData = await fetchData(templateApiUrl);
        });

        // Function to handle drag-and-drop
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropZone.classList.add('highlight');
        });

        dropZone.addEventListener('dragleave', function() {
            dropZone.classList.remove('highlight');
        });

        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropZone.classList.remove('highlight');
            const file = e.dataTransfer.files[0];
            
            if (file) {
                // Same code as in the change event handler
                const reader = new FileReader();
                reader.onload = function(e) {
                    // ... Same as previous example ...
                };
                reader.readAsText(file);
            }
        });

        // Function to trigger file input when the button is clicked
        document.getElementById('uploadButton').addEventListener('click', function() {
            document.getElementById('csvFileInput').click();
        });
    </script>


  </body>
</html>
